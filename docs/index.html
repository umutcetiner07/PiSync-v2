<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PiSync — Testnet Demo</title>
  <meta name="description" content="PiSync testnet demo: Pi SDK login and test payment." />
  <style>
    :root{
      --pi:#5a2ca0; --bg:#f7f5fb; --card:#ffffff; --text:#1f1634; --muted:#6b5a86;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu; color:var(--text); background:var(--bg);
    }
    header{
      padding:20px 16px; background:linear-gradient(160deg,#6a36c9,#4d249e); color:#fff;
    }
    .wrap{max-width:940px; margin:0 auto; padding:0 16px;}
    .brand{display:flex; align-items:center; gap:12px;}
    .brand .logo{
      width:40px; height:40px; border-radius:10px; background:#fff1; display:grid; place-items:center; border:1px solid #ffffff33;
      font-weight:700;
    }
    h1{margin:0; font-size:22px}
    main{padding:24px 0 64px}
    .card{
      background:var(--card); border:1px solid #e9e3f6; border-radius:12px; padding:18px; margin:16px 0;
      box-shadow:0 4px 18px rgba(90,44,160,0.06);
    }
    .row{display:flex; flex-wrap:wrap; gap:16px}
    .row > .card{flex:1 1 280px}
    button{
      padding:10px 16px; border-radius:10px; border:1px solid #d8cfee; background:#fff; color:var(--pi);
      font-weight:600; cursor:pointer; transition:.18s ease; box-shadow:0 2px 8px rgba(90,44,160,0.08);
    }
    button.primary{background:var(--pi); color:#fff; border-color:#4f239d}
    button:hover{transform:translateY(-1px)}
    code, .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
    .status{color:var(--pi); font-weight:600}
    footer{padding:24px 16px; color:var(--muted); text-align:center}
    a{color:var(--pi); text-decoration:none}
    .pill{display:inline-block; padding:3px 8px; border-radius:999px; background:#efe9fb; color:var(--pi); font-size:12px; font-weight:700}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="brand">
        <div class="logo">π</div>
        <div>
          <h1>PiSync — Testnet Demo</h1>
          <div class="pill mono">Netlify • Testnet</div>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="card">
      <h2>Welcome</h2>
      <p>This is a minimal demo to verify Pi SDK login and a User‑to‑App test payment (PiTest) for Hackathon step 11.</p>
      <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:10px;">
        <button class="primary" onclick="piLogin()">Login with Pi</button>
        <button onclick="testPayment()">Test Payment (1 PiTest)</button>
      </div>
      <p id="status" class="status" style="margin-top:10px;"></p>
    </div>

    <div class="row">
      <div class="card">
        <h3>How to test</h3>
        <ol>
          <li>Open this page in Pi Browser.</li>
          <li>Tap “Login with Pi” and authorize.</li>
          <li>Tap “Test Payment” and follow the Pi payment overlay.</li>
        </ol>
      </div>
      <div class="card">
        <h3>Links</h3>
        <ul>
          <li><a href="/privacy.html">Privacy Policy</a></li>
          <li><a href="/terms.html">Terms of Service</a></li>
          <li><a href="https://developer.minepi.com/" target="_blank" rel="noopener">Pi Developer</a></li>
        </ul>
      </div>
    </div>
  </main>

  <footer>
    © 2025 PiSync — Demo for Pi Network Testnet
  </footer>

  <!-- Pi SDK -->
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
  <script>
    // Initialize Pi SDK
    Pi.init({ version: "2.0" });

    async function piLogin() {
      try {
        const scopes = ['username', 'payments'];
        const auth = await Pi.authenticate(scopes, onIncompletePaymentFound);
        document.getElementById('status').textContent = `Logged in as @${auth.user.username}`;
        window.piUser = auth.user;
      } catch (e) {
        alert('Login failed: ' + (e?.message || e));
      }
    }

    async function onIncompletePaymentFound(payment) {
      console.log('Incomplete payment:', payment);
    }

    async function testPayment() {
      try {
        if (!window.piUser) await piLogin();
        const paymentData = {
          amount: 1,
          memo: "PiSync test payment",
          metadata: { orderId: "demo-" + Date.now() }
        };
        const payment = await Pi.createPayment(paymentData, {
          onReadyForServerApproval: async (paymentId) => {
            console.log('Approve on server (demo, no backend):', paymentId);
          },
          onReadyForServerCompletion: async (paymentId, txid) => {
            console.log('Complete on server (demo):', paymentId, txid);
          },
          onCancel: (reason) => {
            alert('Payment cancelled: ' + reason);
          },
          onError: (error) => {
            alert('Payment error: ' + (error?.message || error));
          }
        });
        console.log('Payment created:', payment);
      } catch (e) {
        alert('Payment failed: ' + (e?.message || e));
      }
    }
  </script>
</body>
</html>
